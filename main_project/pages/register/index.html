<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <title>Регистрация</title>
        <script src="js/create_div.js"></script>
        <script src="js/create_element.js"></script>
        <script src="js/create_alert.js"></script>
        <script>

            document.addEventListener("DOMContentLoaded", function() {
                let header = document.createElement("header");
                    app.createDiv("body", header, "bg-secondary p-4 text-center" );
                    header.append(document.createTextNode("HEADER"));
                let footer = document.createElement("footer");
                    app.createDiv("body", footer, "fixed-bottom bg-secondary p-1 text-center");
                    footer.append(document.createTextNode("FOOTER"));
                let form = document.createElement("form");
                    app.createDiv("body", form, "col-sm-7 col-lg-3 mx-auto");
                //создаем элементы формы
                    let username = document.createElement("input");
                        app.createElmnt(username, "username", "text", "введите логин", "form-control mt-5 mb-2 shadow-sm", form);
                    let email = document.createElement("input");
                        app.createElmnt(email, "email", "email", "введите емэйл", "form-control mb-2 shadow-sm", form);
                    let password = document.createElement("input");
                        app.createElmnt(password, "password", "password", "пароль", "form-control mb-2 shadow-sm", form);
                    let confirmpassword = document.createElement("input");
                        app.createElmnt(confirmpassword, "confirmpassword", "password", "повторите пароль", "form-control mb-4 shadow-sm", form);
                    let registerbutton = document.createElement("button");
                        app.createElmnt(registerbutton, "registerbutton", "button", "", "form-control btn btn-primary font-weight-bold", form);
                        registerbutton.append(document.createTextNode("register"));
                //создаём див для оповещений. сами оповещения, туда же сунем див с результатом обращения к базе данных
                let alertDiv = document.createElement("div");
                    app.createDiv("body", alertDiv, "container col-sm-7 col-lg-3 p-5 text-center");
                let result = document.createElement("div");
                    result.className = "result bg-success rounded font-weight-bold text-white mt-5 p-2 text-center";

                    let alertUsername = document.createElement("div");
                        app.createAlert(alertUsername, "Придумайте логин");
                    let alertEmail = document.createElement("div");
                        app.createAlert(alertEmail, "Введите email");
                    let alertPasswordEmpty = document.createElement("div");
                        app.createAlert(alertPasswordEmpty, "Введите пароль");
                    let alertConfirmPassword = document.createElement("div");
                        app.createAlert(alertConfirmPassword, "Пароли не совпадают");
                //проверяем поля, выводим ошибки, если все в порядке отправляем форму
                registerbutton.addEventListener("click", function(event) {
                    event.preventDefault();
                    if (!username.value) {
                        alertDiv.append(alertUsername);}
                    if (!email.value.includes("@")) {
                        alertDiv.append(alertEmail);}
                    if (!password.value) {
                        alertDiv.append(alertPasswordEmpty);}
                    if (!(password.value == confirmpassword.value)) {
                        alertDiv.append(alertConfirmPassword);}
                    if (username.value && email.value.includes("@") && password.value && (password.value == confirmpassword.value)) {
                        //закрываем все не закрытые ошибки
                        $('.close').alert("close")
                        fetch("./php/script.php", {
                            method: "POST",
                            body: new FormData(form)
                        })
                        .then(response => {
                            return response.text();
                        })
                        .then(text => {
                            document.querySelector(".result").innerHTML = text;
                        })
                        alertDiv.append(result);
                    }
                })
            })
        </script>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    </head>
    <body>
    </body>
</html>
